<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon Icon -->
    <link rel="icon" type="image/x-icon" href="/assets/brand-icon.svg">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Links To All Style Files -->
    <link rel="stylesheet" href="./main.css">

    <title>Every Sunday | Cart</title>
    <style>
        /* CSS here */
        .cart-section{
            padding-block: 5rem;
        }
        table {
            width: 100%;
        }
        td{
            text-align: center;
            padding:0.5rem 1rem;
            border:1px solid var(--background-dark);
        }
        #append select{
           background-color: var(--background-dark);
           color:var(--white);
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <img src="./assets/brand-logo.svg" alt="Every Sunday Logo">
            <ul>
                <li><a href="/index.html">Home</a></li>
                <li><a href="/destination.html">Destination</a></li>
                <li><a href="/feedback.html">Feedback</a></li>
                <li><a href="/prices.html">Pricing</a></li>
            </ul>
            <!-- <div id="toggle">
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div> -->
            <div id="login-container">
                <a href="./login.html" id="loginBtn"><i class="fa-solid fa-user" id="login-btn"></i></a>
                <div style="display: none;">
                    <a href='./checkout.html'><i class="fa-solid fa-cart-shopping" style="margin-right:1rem"></i></a>
                    <a href="/" id="logout-btn" class='btn-small' style='border-radius:50px;color:var(--white)'>Log Out</a>
                </div>       
            </div>
        </nav>
    </header>
    <main>
        <section class="container cart-section">
            <!--  -->
            <h1>Your <span>Cart</span></h1>
            <table>
                <thead class="thead">
                    <th>City</th>
                    <th>People</th>
                    <th>Days</th>
                    <th>Tier</th> 
                    <th>Remove Item</th>
                </thead>
                <tbody class="append" id="append">
                    <!-- Date Appended Here -->
                </tbody>
            </table>
            <div class="checkout-container">
                <h4>Your Total is $<span id="total"></span></h4>
                <div>
                    <button id="save-cart" class="btn secondary-btn">Save Cart</button>
                    <button id="buy-now" class="btn">Buy Now</button>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <section class="articles"></section>
        <div class="container">
            <h1>Get started and early <span>Update</span> about our package</h1>
            <!-- Copy this searchbox If you want to use it somewhere else -->
            <div class="searchbox">
                <input  type="text" placeholder="Enter your email">
                <button class="btn" id="cta">Get Started</button>
            </input>
            </div>
            <hr>
            <div class="footer">
                <img src="./assets/brand-logo.svg" alt="Every Sunday Logo">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/">Destination</a></li>
                    <li><a href="/">Feedback</a></li>
                    <li><a href="/">Pricing</a></li>
                </ul>
                <p><i class="fa-regular fa-copyright"></i> 2023 Every Sunday</p>
            </div>
            <div class="socials">
                <div class="social">
                    <a href="https://www.instagram.com/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                </div>
                <div class="social">
                    <a href="https://twitter.com/" target="_blank"><i class="fa-brands fa-twitter"></i></a>
                </div>
                <div class="social">
                    <a href="https://www.facebook.com/" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
<script src="main.js"></script>
<script>
    // JS code goes here
    let tbody = document.querySelector('#append');
    let total = document.querySelector('#total');
    let saveCart=document.querySelector('#save-cart');
    let buyBtn=document.querySelector('#buy-now');

    window.addEventListener('load', getUser);
    let cartItems=[];
    let user;
    let totalValue=0;
async function getUser() {
    let id=JSON.parse(localStorage.getItem('userId'));
    let url = `https://mock-every-sunday-server.onrender.com/users?id=${id}`;
    try {
        let res = await fetch(url);
        let data= await res.json();
        console.log(data[0].cart);
        user=data[0];
        cartItems=data[0].cart;
        displayCart(cartItems);
    } catch (e) {
        console.log(e);
    }
}

function displayCart(cart){
        tbody.innerHTML="";
        cart.forEach((item,i)=>{
            let price = item.price;
            let row = document.createElement('tr');
            
            let city=document.createElement('td');
            city.innerText = item.city;
            
            let numPeople=document.createElement('td');
            // numPeople.style.display = 'flex';
            let peopleValue= document.createElement('p');
            peopleValue.innerText =item.numOfPeople;
            let minus1=document.createElement('button');
            minus1.innerText='-';
            minus1.classList.add('btn-small');
            minus1.addEventListener('click',()=>{
                if(peopleValue.innerText>1){
                    peopleValue.innerText=peopleValue.innerText-1;
                    item.numOfPeople=+peopleValue.innerText;
                }
            })
            let plus1=document.createElement('button');
            plus1.innerText='+';
            plus1.classList.add('btn-small');
            plus1.addEventListener('click',()=>{
                peopleValue.innerText=peopleValue.innerText+1;
                item.numOfPeople=+peopleValue.innerText;
            })
            numPeople.append(minus1,peopleValue,plus1);

            let numDays=document.createElement('td');
            // numDays.style.display = 'flex';
            let daysValue= document.createElement('p');
            daysValue.innerText =item.numOfDays;
            let minus2=document.createElement('button');
            minus2.innerText='-';
            minus2.classList.add('btn-small');
            minus2.addEventListener('click',()=>{
                if(daysValue.innerText>1){
                    daysValue.innerText=daysValue.innerText-1;
                    item.numOfDays=+daysValue.innerText;
                }
            })
            let plus2=document.createElement('button');
            plus2.innerText='+';
            plus2.classList.add('btn-small');
            plus2.addEventListener('click',()=>{
                daysValue.innerText=daysValue.innerText+1;
                item.numOfDays=+daysValue.innerText;
            })
            numDays.append(minus2,daysValue,plus2);

            let tierCont=document.createElement('td');
            let tier = document.createElement("select");
            let options = ["Basic", "Premium", "Luxury"];
            for (let i = 0; i < options.length; i++) {
                let optionElement = document.createElement("option");
                optionElement.text = options[i];
                optionElement.value = options[i];
                tier.append(optionElement);
            }
            if(item.tier=='Basic'){
                tier.value='Basic';
            }else if(item.tier=='Premium'){
                tier.value='Premium';
            }else if(item.tier=='Luxury'){
                tier.value='Luxury';
            }
            tierCont.append(tier);

            let td=document.createElement('td');
            let delBtn=document.createElement('button');
            delBtn.innerText="Remove Item";
            delBtn.classList.add('btn');
            delBtn.style.backgroundImage='none';
            delBtn.style.backgroundColor='var(--failure)';
            td.append(delBtn)

            row.append(city,numPeople,numDays,tierCont,td);
            tbody.append(row);
        })
}

function getTotal(){
    cartItems.forEach((item)=>{
        if(item.tier=='Basic'){
            totalValue+=item.basePrice;
        }else if(item.tier=='Premium'){
            totalValue+=item.basePrice*2;
        }else if(item.tier=='Luxury'){
            totalValue+=item.basePrice*3;
        }
    })
    total.innerText=totalValue;
}


async function postCart(id, userCart) {
  let url = `https://mock-every-sunday-server.onrender.com/users/${id}`;
  try {
    let res = await fetch(url, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        cart: userCart,
      }),
    });
    let data = await res.json();
    console.log(data);
    displayMessage("Added To Cart", "success");
  } catch (e) {
    console.log(e);
    displayMessage("Error", "warning");
  }
}

    
</script>